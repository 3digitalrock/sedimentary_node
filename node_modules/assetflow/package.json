{
  "name": "assetflow",
  "description": "Asset deployment for node",
  "version": "0.1.6",
  "homepage": "https://github.com/verbling/assetflow",
  "author": {
    "name": "Verbling"
  },
  "repository": {
    "type": "git",
    "url": "git://github.com/verbling/assetflow.git"
  },
  "bugs": {
    "url": "https://github.com/verbling/assetflow/issues"
  },
  "licenses": [
    {
      "type": "MIT",
      "url": "https://github.com/verbling/assetflow/blob/master/LICENSE-MIT"
    }
  ],
  "contributors": [
    {
      "name": "Thanasis Polychronakis",
      "url": "http://thanpol.as"
    }
  ],
  "main": "tasks/task-main.js",
  "engines": {
    "node": ">= 0.8.0"
  },
  "scripts": {
    "test": "grunt test"
  },
  "dependencies": {
    "when": "~1.8.1",
    "grunt": "~0.4.0",
    "grunt-ss-helpers": "0.0.9",
    "collections": "~0.1.15",
    "grunt-string-replace": "https://github.com/thanpolas/grunt-string-replace/tarball/7e6087974025bb5067f579f1124da493fce3527a",
    "regexp-quote": "0.0.0",
    "config": "~0.4.23",
    "timely": "0.0.1",
    "pace": "0.0.4",
    "yaml": "~0.2.3",
    "async": "~0.2.8",
    "knox": "~0.8.4",
    "grunt-s3": "~0.2.0-alpha.2"
  },
  "devDependencies": {
    "grunt-mocha-test": "~0.6.1",
    "chai": "~1.7.2",
    "sinon": "~1.7.3",
    "grunt-contrib-watch": "~0.5.1",
    "grunt-contrib-clean": "~0.5.0",
    "grunt-release": "~0.3.3"
  },
  "keywords": [
    "gruntplugin",
    "asset",
    "assets",
    "asset pipeline",
    "deployment",
    "deploy",
    "pipeline"
  ],
  "readme": "# assetflow\n\nAssetflow is an asset deployment tool. It supports md5 hash comparison with **S3** and enables you to create powerful asset flows easily and fast. It is a [Grunt task][grunt] and applies solid cache-busting techniques transparently.\n\n> If you are not familiar with Grunt check out the [Grunt's Getting Started guide][Getting Started].\n\n[![Build Status](https://travis-ci.org/verbling/assetflow.png?branch=master)](https://travis-ci.org/verbling/assetflow)\n\n## Overview\n\nA typical deployment flow using assetflow:\n\n* Scan assets and generate MD5 hashes.\n* Create the `manifest.json` file.\n* Copy all assets and rename them with their md5 hash to a temporary location.\n* Perform `HEAD` operations with **S3** and compare hashes using S3's `ETAG`.\n* Upload all assets that did not have a matching `ETAG`.\n\nOptionally there are two more tasks you can perform:\n\n* Search & replace any set of assets based on a custom keyword, i.e. `__ASSET(img/logo.jpg)`.\n* Create the `clientManifest.js` file, a client optimized subset of the manifest.\n\n## Install\n\n```shell\nnpm install assetflow --save-dev\n```\n\n## Table Of Contents\n\n* [Grunt Task `assets`](#grunt-task-assets) :: Creates the manifest file and copies your assets to a temp folder.\n* [Grunt Task `assetsReplace`](#grunt-task-assetsreplace) :: Replaces defined keywords in files using the manifest file.\n* [Grunt Task `assetsBundle`](#grunt-task-assetsbundle) :: Create a front-end optimized manifest file.\n  - [Using assetflow on the web](#using-assetflow-on-the-front-end)\n* [Grunt Task `assetsS3`](#grunt-task-assetss3) :: Compare assets' hashes with S3 and upload new and changed files.\n* [Using Assetflow on Node](#using-assetflow-on-node)\n\n## Grunt Task `assets`\n\nThe `assets` task performs these operations:\n\n* Scans all the defined assets.\n* Generates **md5** hashes for each asset.\n* Create the `manifest.json` file.\n  - If a manifest file exists, it will compare the hashes.\n* Copy all new or updated assets and rename them with their md5 hash to a temporary location.\n\nWhen this task finishes all your assets have been copied to a new temporary folder that you defined. This folder will contain your assets renamed with their own hash, like so:\n\n`app.js` --> `app-h522md41d.js`\n\nThe `manifest.json` file generated by this task keeps a reference to all your assets so their names can be properly resolved in all environments.\n\n### Options\n\n#### `manifest`\n**Type**: `string` **Default**: `manifest.json`\n\nDefine the location of the manifest file.\n\n#### `cdnurl`\n**Type**: `string` **Default**: *none*\n\nAdd the url of your CDN to prepend it to all assets.\n\n#### `rel`\n**Type**: `string` **Default**: *none*\n\nThe `rel` option will perform directory subtraction on the source to calculate the relative path to the asset. Consider this case:\n\nYour folder of static assets is under `assets/`, so the path to your logo would be `assets/img/logo.png` which would be accessed by the browser as `/img/logo.png`.\n\nDeclaring the `assets` folder as a `rel` path will make sure that all assets have the proper url.\n\nExample\n```js\nassets: {\n  options: {\n    rel: 'assets/'\n  },\n  all: {\n    src: 'assets/**',\n    dest: 'temp/assets'\n  }\n}\n```\n\n#### `truncateHash`\n**Type**: `number` **Default**: *none*\n\nThe **md5** hash is 32 bytes long, you don't need all of it, use this option to truncate the hash down to *n* chars.\n\n#### `prepend`\n**Type**: `string` **Default**: *none*\n\nThis option will prepend a value to the asset's key. It is mostly used to prepend a slash and make the asset key absolute, for example:\n\nBy default, the `assets` task will create records in the `manifest.json` file as relative web paths: `img/logo.png`. If you need the key to be an absolute path then you have to use `prepend`.\n\n```js\noptions: {\n  prepend: '/'\n}\n```\n\n#### `maxOperations`\n**Type**: `number` **Default**: `100`\n\nThe maximum number of concurrent operations, in this case the operations are file copying.\n\n> Set this to 0 to disable throttling. Set it to 1 to make all operations serial.\n\n#### `progress`\n**Type**: `boolean` **Default**: `false`\n\nA fancy progress bar.\n\n#### `debug`\n**Type**: `boolean` **Default**: `false`\n\nPrint extra debugging information.\n\n### Example\n\nHere's an annotated configuration for the `assets` task:\n\n```js\nassets: {\n  // global task options\n  options: {\n    // don't output debug information\n    debug: false,\n    // trancate the hash length to 8 chars.\n    truncateHash: 8,\n    // define the location of the manifest file.\n    manifest: 'temp/manifest.json',\n    // define the location of the cdn.\n    cdnurl: 'http://d3s3z9buwru1xx.cloudfront.net/assets/',\n    // Set maximum number of file copying concurent operations.\n    maxOperations: 100,\n    // Show a fancy progress indicator\n    progress: true,\n    // Set path to substract so the relative path for the assets can be calculated.\n    rel: 'lib/'\n  },\n\n  all: {\n    // local task options\n    options: {\n      // change the rel path to test/case\n      rel: 'assets/'\n    },\n    src: [\n      // all files under folder assets\n      'assets/**',\n      // except all files in less folder\n      '!assets/less/**',\n      // except all files in handlebars folder\n      '!assets/handlebars/**'\n    ],\n    dest: 'temp/assets'\n  }\n}\n```\n<sup>[↑ Back to TOC](#table-of-contents)</sup>\n\n## Grunt Task `assetsReplace`\n\nThe `assetsReplace` task will search and replace the contents of your assets. It is useful for cases where you don't have the ability of a '*helper*' to resolve your assets.\n\nLESS files are a typical example, use a custom keyword to include your assets and run the `assetsReplace` task to populate the asset urls in your `.less` files. For example if the custom keyword is `__ASSET()`:\n\n```less\n@bg-dot-light: url(__ASSET(img/pdf-icon-cv.png)) repeat 0 0 #2a2a2a;\n```\n\nAfter the `assetsReplace` task is executed the same line will look like this:\n\n```less\n@bg-dot-light: url(http://d3s3z9buwru1xx.cloudfront.net/assets/img/pdf-icon-cv-fk44j2s.png) repeat 0 0 #2a2a2a;\n```\n\n> The `assetsReplace` task is based on [grunt-string-replace][grunt-replace] by [@erickrdch][erickrdch]\n\n\n### Options\n\n#### `manifest`\n**Type**: `string` **Default**: `manifest.json`\n\nDefine the location of the manifest file.\n\n#### `key`\n**Type**: `string` **Default**: *none*\n\nDefine the keyword that will be searched for replacement. Use the `%` char as a placeholder for the asset name. e.g.:\n```js\noptions: {\n  key: '__ASSET(%)'\n}\n```\n\n#### `keyRegex`\n**Type**: `string` **Default**: *none*\n\nUse this to define a regex as a keyword. The type must be string, but the string will be evaluated as a regex. The `%` char is a placeholder for the asset name and the reason why this option needs to be a string instead of a regex type.\n\nSo take case to double escape what you need escaped, e.g.\n\n```js\n// this regex\nvar reg = /match[\\s]space/;\n\n// is represented like that as a string:\nvar strReg = 'match[\\\\\\s]space';\n```\n\n#### `prepend`\n**Type**: `string` **Default**: *none*\n\nThis option will prepend a value to the asset's key. It is mostly used to prepend a slash and make the asset key absolute.\n\n#### `debug`\n**Type**: `boolean` **Default**: `false`\n\nPrint extra debugging information.\n\n### Example\n\nHere's an annotated configuration for the `assetsReplace` task:\n\n```js\nassetsReplace: {\n  // global task options\n  options: {\n    // don't output debug information\n    debug: false,\n    // define the location of the manifest file.\n    manifest: 'temp/manifest.json',\n  },\n  // the less target\n  less: {\n    options: {\n      // define the keyword for this target\n      key: '__ASSET(%)'\n    },\n    files: {\n      // Search & replace all .less files under the assets/less folder\n      // and output the result in the temp/less folder\n      'temp/less/': ['assets/less/**/*.less']\n    }\n  },\n  // the handlebars target\n  handlebars: {\n    options: {\n      // a regex for lax matching {{asset \"%\"}} allowing for spaces in between\n      // and single quotes.\n      keyRegex: '\\\\\\{\\\\\\{[\\\\\\s]*asset[\\\\\\s]+[\\\\\\'\\\\\\\"]{1}%[\\\\\\'\\\\\\\"]{1}[\\\\\\s]*\\\\\\}\\\\\\}',\n      // prepend the slash on every asset query\n      prepend: '/'\n    },\n    // all the files from the assets/handlebars folder\n    src: 'assets/handlebars/**/*.hbs',\n    // output to temp/handlebars folder\n    dest: 'temp/handlebars/'\n  }\n}\n```\n\nFiles that are produced with the `assetsReplace` task should be in your codebase and tracked.\n\nFor example, here is a typical setup for less files:\n\n#### Directory Structure\n\n```\nassets-replace.less\nassets.less   <--- this is auto-generated by Grunt\nmain.less\nrestStyles.less\n```\n\n#### main.less\n\n```less\n@import \"assets\"\n\n@import \"restStyles\"\n// ....\n```\n\n#### assets-replace.less\n\n```less\n//\n// ONLY ADD IMAGES TO assets-replace.less\n// IMAGES ADDED TO assets.less WILL BE OVERWRITTEN\n//\n\n@asset_img_logo: \"__ASSET(/assets/logo.png)\";\n@asset_img_cover: \"__ASSET(/assets/cover.jpg)\";\n```\n\n#### assetsReplace task generates assets.less:\n\nThis file is generated by the `assetsReplace` Grunt task.\n\n```less\n//\n// ONLY ADD IMAGES TO assets-replace.less\n// IMAGES ADDED TO assets.less WILL BE OVERWRITTEN\n//\n\n@asset_img_logo: \"/assets/logo.png\";\n@asset_img_cover: \"/assets/cover.jpg\";\n```\n\n#### restStyles.less\n\n```less\n#header{\n  .logo {\n    position: relative;\n    margin: 0;\n    background: url(@asset_img_logo) bottom center no-repeat;\n  }\n\n  .cover {\n    background: url(@asset_img_cover) no-repeat #577d9c;\n    cursor: default;\n    padding-left: 35px;\n    background-position: 9px 9px;\n  }\n}\n\n```\n\n<sup>[↑ Back to TOC](#table-of-contents)</sup>\n\n## Grunt Task `assetsBundle`\n\nThe assetsBundle task will create a compact version of the manifest file, optimized for transferring to the client as a javascript file. The `manifest.json` file is pretty large and not suited for getting transfered. Furthermore it might be the case where you have several hundreds, if not thousands of assets but you only need a handful to be consumed by your front-end app. This is the task that enables you to do this.\n\n### Options\n\n#### `manifest`\n**Type**: `string` **Default**: `manifest.json`\n\nDefine the location of the manifest file.\n\n#### `amd`\n**Type**: `boolean` **Default**: `false`\n\nexport the assets as an AMD module.\n\n#### `commonjs`\n**Type**: `boolean` **Default**: `false`\n\nexport the assets using commonjs pattern. e.g: module.exports=..\n\n#### `ns`\n**Type**: `string` **Default**: `ASSETS`\n\nDefine a namespace to export using the global `window` Object. You can use dot notation.\n\n#### `assets`\n**Type**: `Array` **Default**: `[]`\n\nAn array of strings where you define the asset filename keys you want included.\n\n#### `debug`\n**Type**: `boolean` **Default**: `false`\n\nPrint extra debugging information.\n\n\n### Example\n\nHere's an annotated configuration for the `assetsBundle` task:\n\n```js\nassetsBundle: {\n  // global task options\n  options: {\n    // define the location of the manifest file.\n    manifest: 'temp/manifest.json',\n    // export as AMD\n    amd: true\n  },\n\n  // Export as amd\n  amd: {\n    dest: 'temp/bundles/clientManifest.amd.js'\n  },\n\n  // Export using namespaces\n  ns: {\n    options: {\n      // Export assets on this global namespace:\n      ns: 'app.assets'\n    },\n    dest: 'temp/bundles/clientManifest.ns.js'\n  }\n}\n```\n\n### Using assetflow on the Front-End\n\nThe javascript file generated by the `assetsBundle` task will export an Object that contains key value pairs to the assets. If you are using AMD to export the assets this is how you'd access them:\n\n```js\nvar assets    = require('assets');\n\nvar asset = assets['/img/logo.png'];\n// --> https://d3s3z9buwru1xx.cloudfront.net/assets/img/logo-fh422j4f.png\n```\n\n> This is a weak part in the API and will surely see changes in the future.\n\n<sup>[↑ Back to TOC](#table-of-contents)</sup>\n\n## Grunt Task `assetsS3`\n\nThe `assetsS3` task will read the `manifest.json` file and upload all the assets to **S3**. Although it's optional, it is highly advised to use the `checkS3Head` option which enables md5 hash checking between S3 and your local files.\n\n> The `assetsS3` task is based on [grunt-S3][grunt-S3] by [@pifantastic][pifantastic]. [All options from that task](https://github.com/pifantastic/grunt-s3#options) are available in this one too.\n\n\n### Options\n\nThese are the options that are only available in the `assetsS3` task of Assetflow.\n\n#### `manifest`\n**Type**: `string` **Default**: `manifest.json`\n\nDefine the location of the manifest file.\n\n#### `checkS3Head`\n**Type**: `boolean` **Default**: `false`\n\nPerform md5 hash comparisons between the local assets and the ones in S3. It is highly advisable that you enable this option so you only upload files that have been updated.\n\n#### `rel`\n**Type**: `string` **Default**: *none*\n\nThe `rel` option will perform directory subtraction on the source to calculate the relative path to the asset.\n\n\n#### `maxOperations`\n**Type**: `number` **Default**: `100`\n\nThe maximum number of concurrent operations, in this case the operations are network uploads.\n\n> Set this to 0 to disable throttling. Set it to 1 to make all operations serial.\n\n#### `progress`\n**Type**: `boolean` **Default**: `false`\n\nA fancy progress bar.\n\n#### `debug`\n**Type**: `boolean` **Default**: `false`\n\nPrint extra debugging information.\n\n\n### Grunt-S3 Options\n\nThese options are available by [Grunt-S3][], sic:\n\nThe grunt-s3 task is now a [multi-task](https://github.com/gruntjs/grunt/wiki/Creating-tasks); meaning you can specify different targets for this task to run as.\n\nThe following are the default options available to each target.\n\n* **key** - (*string*) An Amazon S3 credentials key\n* **secret** - (*string*) An Amazon S3 credentials secret\n* **bucket** - (*string*) An Amazon S3 bucket\n* **region** - (*string*) An Amazon AWS region (see http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region)\n* **maxOperations** - (*number*) max number of concurrent transfers - if not specified or set to 0, will be unlimited.\n* **encodePaths** - (*boolean*) if set to true, will encode the uris of destinations to prevent 505 errors. Default: false\n* **headers** - (*object*) An object containing any headers you would like to send along with the\ntransfers i.e. `{ 'X-Awesomeness': 'Out-Of-This-World', 'X-Stuff': 'And Things!' }`\n* **access** - (*string*) A specific Amazon S3 ACL. Available values: `private`, `public-read`, `\npublic-read-write`, `authenticated-read`, `bucket-owner-read`, `bucket-owner-full-control`\n* **gzip** - (*boolean*) If true, uploads will be gzip-encoded.\n* **gzipExclude** - (*array*) Define extensions of files you don't want to run gzip on, an array of strings ie: `['.jpg', '.jpeg', '.png']`.\n* **upload** - (*array*) An array of objects, each object representing a file upload and containing a `src`\nand a `dest`. Any of the above values may also be overriden.\n* **download** - (*array*) An array of objects, each object representing a file download and containing a\n`src` and a `dest`. Any of the above values may also be overriden.\n* **del** - (*array*) An array of objects, each object containing a `src` to delete from s3. Any of\nthe above values may also be overriden.\n* **debug** - (*boolean*) If true, no transfers with S3 will occur, will print all actions for review by user\n\n### Example\n\nHere's an annotated configuration for the `assetsS3` task:\n\n```js\nassetsS3: {\n  options: {\n    // no debug info\n    debug: false,\n    // enable checking md5 hashes by performing S3 HEAD requests.\n    checkS3Head: true,\n    // the manifest file\n    manifest: 'temp/manifest.json',\n\n    // aws credentials\n    key: 'AWS-KEY',\n    secret: 'AWS-SECRET',\n    bucket: 'S3-BUCKET',\n\n    // Enable public access\n    access: 'public-read',\n\n    // don't show the fancy progress indicator.\n    progress: false\n  },\n  all: {\n    // These options override the defaults\n    options: {\n      // limit concurent uploads to 100\n      maxOperations: 100\n    },\n    // the 'upload' option key is required\n    upload: {\n      // all files from temp/assets\n      src: 'temp/assets/**',\n      // a prefix folder on S3\n      dest:  'assets/',\n      // the rel option\n      rel: 'temp/assets/',\n      // gzip uploaded files\n      gzip: true,\n      // excluded these extensions\n      gzipExclude: ['.jpeg', '.jpg', '.png', '.gif', '.less', '.mp3',\n          '.mp4', '.mkv', '.webm', '.gz'],\n      // upload assets with a looong expire Cache-Control header.\n      headers: {'Cache-Control': 'max-age=31536000, public'}\n    }\n  }\n}\n```\n<sup>[↑ Back to TOC](#table-of-contents)</sup>\n\n## Using Assetflow on Node\n\nYou can use the Assetflow library on node:\n\n```js\n// mind the () in the end!\nvar assets = require('assetflow')();\n\nassets.config({\n  manifest: __dirname + '/assetManifest.json'\n});\n\nvar assetUrl = assets.asset('/img/logo.png');\n```\n\n> Like the client API, node's API is weak and may change in the future.\n\n<sup>[↑ Back to TOC](#table-of-contents)</sup>\n\n## Authors\n\n* [@thanpolas][thanpolas]\n\n## Release History\n\n- **v0.1.6**, *26 Jul 2013*\n  - Bug fix for file created with `-undefined` hash, thanks [Younes](https://github.com/interactive-object).\n- **v0.1.5**, *21 Jul 2013*\n  - Updated dependencies versions (Knox specifically had issues that are now fixed)\n- **v0.1.4**, *08 May 2013*\n  - Updated Knox so Assetflow will work for node 0.10.x\n  - Fixed bug when no rel path is used.\n- **v0.1.2**, *17 April 2013*\n  - S3 paths now get normalized using `path.normalize()`.\n- **v0.1.1**, *19 March 2013*\n  - Added support for commonjs for browsers.\n- **v0.1.0**, *Mid March 2013*\n  - Big Bang\n\n## License\nCopyright 2012 Verbling (Fluency Forums Corporation)\n\nLicensed under the MIT License\n\n[grunt]: http://gruntjs.com/\n[Getting Started]: https://github.com/gruntjs/grunt/wiki/Getting-started\n[Gruntfile]: https://github.com/gruntjs/grunt/wiki/Sample-Gruntfile \"Grunt's Gruntfile.js\"\n[grunt-replace]: https://github.com/erickrdch/grunt-string-replace \"Grunt string replace\"\n[grunt-S3]: https://github.com/pifantastic/grunt-s3 \"grunt-s3 task\"\n[pifantastic]: https://github.com/pifantastic \"Aaron Forsander\"\n[erickrdch]: https://github.com/erickrdch \"Erick Ruiz de Chavez on GitHub\"\n[thanpolas]: https://github.com/thanpolas \"Thanasis Polychronakis\"\n",
  "readmeFilename": "README.md",
  "_id": "assetflow@0.1.6",
  "dist": {
    "shasum": "64a2b0aeb2ff9bb00166cb075aa86e11c505487d",
    "tarball": "http://registry.npmjs.org/assetflow/-/assetflow-0.1.6.tgz"
  },
  "_from": "assetflow@",
  "_npmVersion": "1.3.2",
  "_npmUser": {
    "name": "thanpolas",
    "email": "thanpolas@gmail.com"
  },
  "maintainers": [
    {
      "name": "thanpolas",
      "email": "thanpolas@gmail.com"
    }
  ],
  "directories": {},
  "_shasum": "64a2b0aeb2ff9bb00166cb075aa86e11c505487d",
  "_resolved": "https://registry.npmjs.org/assetflow/-/assetflow-0.1.6.tgz"
}
