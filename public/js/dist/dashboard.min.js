/*! 3drs-sedimentary 2014-10-20 */
angular.module("userModule",["ngRoute","ui.router","UserApp"]).config(["$stateProvider","$urlRouterProvider",function(a){a.state("usersAll",{url:"/dashboard/users/all",templateUrl:"/templates/admin/user_all.html",controller:"AdminUserAllCtrl"}).state("usersDetails",{url:"/dashboard/users/:userId",templateUrl:"/templates/admin/user_detail.html",resolve:{userPromise:["Restangular","$stateParams",function(a,b){return a.one("users",b.userId).get().then(function(a){return a})}]},controller:"AdminUserDetailsCtrl"}).state("dashLogin",{url:"/dashboard/login",templateUrl:"/templates/admin/login.html",data:{login:!0},controller:"AdminLoginCtrl"})}]),angular.module("userModule").controller("AdminLoginCtrl",["$scope",function(a){a.user.first_name="Friend"}]),angular.module("videoModule",["ngRoute","ui.router"]).config(["$stateProvider","$urlRouterProvider","$routeProvider",function(a){a.state("videosUpload",{url:"/dashboard/videos/upload",templateUrl:"/templates/admin/video_create.html",controller:"AdminVideoUploadCtrl"}).state("videosList",{url:"/dashboard/videos/all",templateUrl:"/templates/admin/video_all.html",controller:"AdminVideoListCtrl"}).state("videosDetails",{url:"/dashboard/videos/:videoId",templateUrl:"/templates/admin/video_detail.html",controller:"AdminVideoDetailsCtrl"})}]),angular.module("videoModule").controller("AdminVideoListCtrl",["$scope","Restangular",function(a,b){b.all("videos").getList({fields:"uid,title,slug,description,studio,created,status"}).then(function(b){a.videos=b}),a.predicate="upload"}]).directive("vidstatus",function(){var a={1:'<span class="label label-success">Approved</span>',2:'<span class="label label-warning">Pending</span>',3:'<span class="label label-info">Processing</span>',4:'<span class="label label-alert">Rejected</span>',0:'<span class="label label-default">Unknown</span>'};return{restrict:"E",replace:!0,link:function(b,c,d){d.$observe("code",function(b){c.html(a[b])})}}}),angular.module("videoModule").controller("AdminVideoDetailsCtrl",["$scope","$filter","Restangular","$stateParams","$route","$location","$timeout",function(a,b,c,d,e,f,g){c.one("videos",d.videoId).get({fields:"uid,title,description,channels,studio,status,files,thumbnails"}).then(function(b){a.video=b,a.observer=jsonpatch.observe(a.video)}),c.all("studios").getList().then(function(c){a.studios=[],_.forEach(c,function(b){a.studios.push({value:b.uid,text:b.name})}),a.showStudio=function(){var c=b("filter")(a.studios,{value:a.video.studio.uid});return a.video.studio.uid&&c.length?c[0].text:"Not set"}}),c.all("channels").getList().then(function(b){a.channels=[],_.forEach(b,function(b){a.channels.push({value:b.uid,text:b.name})}),a.showChannels=function(){var b=[];return angular.forEach(a.channels,function(c){a.video.channels.indexOf(c.value)>-1&&b.push(c.text)}),b.length?b.join(", "):"Not set"}}),a.statuses=[{value:"1",text:"Approved"},{value:"2",text:"Pending"},{value:"3",text:"Processing"},{value:"4",text:"Rejected"}],a.updateVideo=function(){var b=jsonpatch.generate(a.observer);c.one("videos",a.video.uid).patch(b).then(function(){},function(){})},a.gogoPlayerRanger=function(){videojs("video-player",{plugins:{resolutions:!0}}).ready(function(){function a(){var a=9/16,c=document.getElementById(b.id()).parentElement.offsetWidth;c-=parseInt($("#video-player").parent().css("padding-left")),c-=parseInt($("#video-player").parent().css("padding-right")),b.width(c).height(c*a)}var b=this;b.volume(.75),a(),window.onresize=a}),videojs.options.flash.swf="/js/vendor/video-js.swf"},a.showPlayer=function(){g(function(){a.gogoPlayerRanger()},0)},a.showPlayer(),a.$on("$destroy",function(){videojs("video-player").dispose(),videojs.players={}})}]),angular.module("videoModule").controller("AdminVideoUploadCtrl",function(){}),angular.module("videoModule").controller("AdminDeleteCtrl",["$scope","$modal","$location","$state",function(a,b,c,d){function e(){}a.delModal=function(b,c){a.delVideo={},a.delVideo.id=b,a.delVideo.title=c,a.open()},a.open=function(){var c=b.open({templateUrl:"/admin/views/modal.html",controller:ModalInstanceCtrl,resolve:{delVideo:function(){return a.delVideo}}});c.result.then(function(){e(a.delVideo.id),d.reload()},function(){})}}]);var ModalInstanceCtrl=["$scope","$modalInstance","delVideo",function(a,b,c){a.videoInfo=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}];angular.module("studioModule",["ngRoute","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a){a.state("studiosAll",{url:"/dashboard/studios/all",templateUrl:"/templates/admin/studios_all.html",controller:"AdminStudioAllCtrl"}).state("studiosCreate",{url:"/dashboard/studios/new",templateUrl:"/templates/admin/studio_create.html",controller:"AdminStudioCreateCtrl"}).state("studiosDetails",{url:"/dashboard/studios/:studioId",templateUrl:"/templates/admin/studio_detail.html",controller:"AdminStudioDetailsCtrl"})}]),angular.module("studioModule").controller("AdminStudioDetailsCtrl",["$scope","Restangular","$stateParams",function(a,b,c){b.one("studios",c.studioId).get().then(function(b){a.studio=b}),b.one("studios",c.studioId).getList("videos",{limit:5,fields:"uid,title,slug,description,created,status"}).then(function(b){a.videos=b})}]),angular.module("studioModule").controller("AdminStudioCreateCtrl",["$scope","Restangular",function(a,b){a.createStudio=function(){a.submitted=!0,b.all("studios").post({name:a.studio_name,description:a.studio_description}).then(function(){},function(b){a.submitted=!1,console.log("Error: Status code",b.status),console.log(b.data)})}}]),angular.module("AdminApp",["userModule","videoModule","studioModule","ngRoute","ui.bootstrap","ui.router","xeditable","restangular","angular-loading-bar","checklist-model","angularMoment","UserApp"]).config(["$interpolateProvider","$locationProvider","$sceDelegateProvider","RestangularProvider","cfpLoadingBarProvider","$stateProvider","$urlRouterProvider",function(a,b,c,d,e,f,g){a.startSymbol("{[{"),a.endSymbol("}]}"),b.html5Mode(!0),d.setBaseUrl("http://api.3drs.synth3tk.com"),e.latencyThreshold=500,e.includeSpinner=!1,c.resourceUrlWhitelist(["self","http://slate.3digitalrockstudios.com.s3.amazonaws.com/**"]),d.addResponseInterceptor(function(a,b){var c;return c="getList"===b?a.items:a}),f.state("dashboard",{url:"/dashboard",templateUrl:"/templates/admin/home.html",controller:"AdminDashboardCtrl"}),g.otherwise("/dashboard")}]).factory("WebApi",["Restangular",function(a){return a.withConfig(function(a){a.setBaseUrl("http://3drs.synth3tk.com")})}]).controller("AdminDashboardCtrl",["$scope",function(){}]).run(["$rootScope","editableOptions","user",function(a,b,c){c.init({appId:"542b63aff0d72",heartbeatInterval:0}),b.theme="default"}]);