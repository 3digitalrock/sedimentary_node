/*! 3drs-sedimentary js */
angular.module("userModule",["ngRoute","ui.router","UserApp"]).config(["$stateProvider","$urlRouterProvider",function(a){a.state("usersAll",{url:"/dashboard/users/all",templateUrl:"/templates/admin/user_all.html",controller:"AdminUserAllCtrl"}).state("usersDetails",{url:"/dashboard/users/:userId",templateUrl:"/templates/admin/user_detail.html",resolve:{userPromise:["Restangular","$stateParams",function(a,b){return a.one("users",b.userId).get().then(function(a){return a})}]},controller:"AdminUserDetailsCtrl"}).state("dashLogin",{url:"/dashboard/login",templateUrl:"/templates/admin/login.html",data:{login:!0},controller:"AdminLoginCtrl"})}]),angular.module("userModule").controller("AdminLoginCtrl",["$scope",function(a){a.user.first_name="Friend"}]),angular.module("videoModule",["ngRoute","ui.router","angularFileUpload","checklist-model"]).config(["$stateProvider","$urlRouterProvider","$routeProvider",function(a){a.state("videosUpload",{url:"/dashboard/videos/upload",templateUrl:"/templates/admin/video_create.html"}).state("videosList",{url:"/dashboard/videos/all",templateUrl:"/templates/admin/video_all.html",controller:"AdminVideoListCtrl"}).state("videosDetails",{url:"/dashboard/videos/:videoId",templateUrl:"/templates/admin/video_detail.html",controller:"AdminVideoDetailsCtrl"}).state("videosTrailers",{url:"/dashboard/trailers",templateUrl:"/templates/admin/video_trailers.html",controller:"AdminVideoTrailersCtrl"})}]),angular.module("videoModule").controller("AdminVideoListCtrl",["$scope","Restangular","Videos",function(a,b,c){a.videos=c.getList({fields:"uid,title,slug,description,studio,created,status",limit:100}).$object,a.predicate="created"}]).directive("vidstatus",function(){var a={1:'<span class="label label-success">Approved</span>',2:'<span class="label label-warning">Pending</span>',3:'<span class="label label-info">Processing</span>',4:'<span class="label label-danger">Rejected</span>',0:'<span class="label label-default">Unknown</span>'};return{restrict:"E",replace:!0,link:function(b,c,d){d.$observe("code",function(b){c.html(a[b])})}}}),angular.module("videoModule").controller("AdminVideoDetailsCtrl",["$scope","$filter","Restangular","$stateParams","$route","$location","$timeout",function(a,b,c,d,e,f,g){c.one("videos",d.videoId).get({fields:"uid,title,description,channels,studio,status,files,thumbnails"}).then(function(b){a.video=b,a.observer=jsonpatch.observe(a.video)}),c.all("studios").getList().then(function(c){a.studios=[],_.forEach(c,function(b){a.studios.push({value:b.uid,text:b.name})}),a.showStudio=function(){var c=b("filter")(a.studios,{value:a.video.studio.uid});return a.video.studio.uid&&c.length?c[0].text:"Not set"}}),c.all("channels").getList().then(function(b){a.channels=[],_.forEach(b,function(b){a.channels.push({value:b.uid,text:b.name})}),a.showChannels=function(){var b=[];return angular.forEach(a.channels,function(c){a.video.channels.indexOf(c.value)>-1&&b.push(c.text)}),b.length?b.join(", "):"Not set"}}),a.statuses=[{value:"1",text:"Approved"},{value:"2",text:"Pending"},{value:"3",text:"Processing"},{value:"4",text:"Rejected"}],a.updateVideo=function(){var b=jsonpatch.generate(a.observer);c.one("videos",a.video.uid).patch(b).then(function(){},function(){})},a.gogoPlayerRanger=function(){videojs("video-player",{plugins:{resolutions:!0}}).ready(function(){function a(){var a=9/16,c=document.getElementById(b.id()).parentElement.offsetWidth;c-=parseInt($("#video-player").parent().css("padding-left")),c-=parseInt($("#video-player").parent().css("padding-right")),b.width(c).height(c*a)}var b=this;b.volume(.75),a(),window.onresize=a}),videojs.options.flash.swf="/js/vendor/video-js.swf"},a.showPlayer=function(){g(function(){a.gogoPlayerRanger()},0)},a.showPlayer(),a.$on("$destroy",function(){videojs("video-player").dispose(),videojs.players={}})}]),angular.module("videoModule").controller("AdminVideoUploadCtrl",["$scope","$upload","Restangular","$location","$rootScope","UploadService","$http",function(a,b,c,d,e,f,g){c.all("channels").getList().then(function(b){a.channellist=[],_.forEach(b,function(b){a.channellist.push({uid:b.uid,name:b.name})})}),c.all("studios").getList().then(function(b){a.studiolist=[],_.forEach(b,function(b){a.studiolist.push({uid:b.uid,name:b.name})})}),a.type={},a.path="",a.$on("$locationChangeSuccess",function(){a.path=d.path().split("/")[2],a.type[a.path]=[],a.type[a.path][0]||(a.type[a.path][0]={file:[],progress:[],form:{},type:a.path})}),a.submitVideoInfo=function(){if(a.type[a.path][0].id=null,a.type[a.path][0].progress=0,"trailers"!=a.path){a.type[a.path][0].formData={title:a.type[a.path].form.title,description:a.type[a.path].form.description,channels:a.type[a.path].form.channels,contact:a.type[a.path].form.contact},delete a.type[a.path][0].formData.contact;var b=c.all("videos").post(a.type[a.path][0].formData);return b.then(function(b){a.type[a.path][0].uid=b.uid})}a.type[a.path][0].formData={title:a.type[a.path].form.title,description:a.type[a.path].form.description,order:"99"},c.all("trailers").post(a.type[a.path][0].formData).then(function(b){a.type[a.path][0].uid=b.uid})},a.onFileSelect=function(b){a.type[a.path][0].file=b,a.type[a.path][0].progress=-1,g({url:"/s3/pgen",method:"POST",data:{size:a.type[a.path][0].file[0].size}}).success(function(b){a.type[a.path][0].file[0].policy=b.policy,a.type[a.path][0].file[0].sig=b.sig})},a.uploadVideo=function(){var c=a.type[a.path][0].file,d="videos/original/",e=a.type[a.path][0].uid+"."+a.type[a.path][0].file[0].type.split("/")[1];a.type[a.path][0].file[0].upload=b.upload({url:"https://s3.amazonaws.com/slate.3digitalrockstudios.com/",method:"POST",data:{key:d+e,AWSAccessKeyId:"AKIAJ4TXEC7GL63G5WIQ",acl:"private",policy:a.type[a.path][0].file[0].policy,signature:a.type[a.path][0].file[0].sig,"Content-Type":""!==c.type?c.type:"application/octet-stream","Content-Length":c.size},file:c}).progress(function(b){a.type[a.path][0].progress=parseInt(100*b.loaded/b.total)}).success(function(b,c){console.log(c),g({url:"/s3/process",method:"POST",data:{videoPath:"/"+d+e,videoFilename:a.type[a.path][0].uid,uploadType:a.path}})}).error(function(a){console.log(a)})},a.abort=function(b,c,d){a.type[a.path][c].file[d].upload.abort(),a.type[a.path][c].file[d].upload=null,a.type[a.path][c].progress=-1}}]).service("UploadService",["$upload",function(a){var b={trailers:1,videos:1},c=[];this.save=function(a){null===a.id&&(a.id=a.type+b[a.type]++,c.push(a),d(a))},this.get=function(a){console.log("getting");for(var b in c)if(c[b].id==a)return c[b]},this.delete=function(a){console.log("deleting");for(var b in c)c[b].id==a&&c.splice(b,1)};var d=function(b){console.log("uploading"),a.upload({url:"/video_uploads/"+b.type,method:"POST",data:b.formData,file:b.file}).progress(function(a){b.progress=parseInt(100*a.loaded/a.total)}).success(function(a,b){console.log(b)}).error(function(a){console.log(a)})};this.list=function(){return c}}]).directive("progressActive",function(){return{restrict:"A",link:function(a,b,c){c.$observe("progress",function(a){"100"===a&&(b.removeClass("active"),b.removeClass("progress-striped"),b.children(".progress-bar").removeClass("progress-bar-primary"),b.children(".progress-bar").addClass("progress-bar-success"))})}}}),angular.module("videoModule").controller("AdminDeleteCtrl",["$scope","$modal","$location","$state","$stateParams","Videos",function(a,b,c,d,e,f){function g(a){f.one(a).remove().then(function(){d.transitionTo(d.current,e,{reload:!0,inherit:!1,notify:!0})})}a.delModal=function(b,c){a.delVideo={},a.delVideo.id=b,a.delVideo.title=c,a.open()},a.open=function(){var c=b.open({templateUrl:"/templates/admin/modal_delete.html",controller:h,resolve:{delVideo:function(){return a.delVideo}}});c.result.then(function(){g(a.delVideo.id)},function(){})};var h=["$scope","$modalInstance","delVideo",function(a,b,c){a.videoInfo=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]}]),angular.module("videoModule").controller("AdminVideoTrailersCtrl",["$scope","Restangular",function(a,b){b.all("trailers").getList().then(function(b){a.trailers=b}),a.predicate="order"}]),angular.module("studioModule",["ngRoute","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a){a.state("studiosAll",{url:"/dashboard/studios/all",templateUrl:"/templates/admin/studios_all.html",controller:"AdminStudioAllCtrl"}).state("studiosCreate",{url:"/dashboard/studios/new",templateUrl:"/templates/admin/studio_create.html",controller:"AdminStudioCreateCtrl"}).state("studiosDetails",{url:"/dashboard/studios/:studioId",templateUrl:"/templates/admin/studio_detail.html",controller:"AdminStudioDetailsCtrl"})}]),angular.module("studioModule").controller("AdminStudioDetailsCtrl",["$scope","Restangular","$stateParams",function(a,b,c){b.one("studios",c.studioId).get().then(function(b){a.studio=b}),b.one("studios",c.studioId).getList("videos",{limit:5,fields:"uid,title,slug,description,created,status"}).then(function(b){a.videos=b})}]),angular.module("studioModule").controller("AdminStudioCreateCtrl",["$scope","Restangular",function(a,b){a.createStudio=function(){a.submitted=!0,b.all("studios").post({name:a.studio_name,description:a.studio_description}).then(function(){},function(b){a.submitted=!1,console.log("Error: Status code",b.status),console.log(b.data)})}}]),angular.module("settingsModule",["ngRoute","ui.router","siyfion.sfTypeahead"]).config(["$stateProvider","$urlRouterProvider","$routeProvider",function(a){a.state("settingsFeatured",{url:"/dashboard/settings/featured",templateUrl:"/templates/admin/settings_featured.html",controller:"AdminSettingsFeaturedCtrl"})}]),angular.module("settingsModule").controller("AdminSettingsFeaturedCtrl",["$scope","WebApi","$http","Restangular",function(a,b,c,d){b.all("featured").get("home").then(function(b){a.featured=b});var e=new Bloodhound({name:"trailers",datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[]});e.initialize(),a.featuredOptions={highlight:!0},a.trailers={displayKey:"title",source:e.ttAdapter()},d.all("trailers").getList({fields:"uid,title"}).then(function(a){e.add(a.originalElement)}),a.addFeatured=function(c,d){b.all("featured").customPUT({uid:d,playlist:c}),a.selectedTrailer=null}}]),angular.module("mailModule",["ngRoute","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a){a.state("mailInbox",{url:"/dashboard/mail/inbox",templateUrl:"/templates/admin/mail_inbox.html",controller:"AdminMailInboxCtrl"}).state("mailReply",{url:"/dashboard/mail/:mailId/reply",templateUrl:"/templates/admin/mail_reply.html",controller:"AdminMailReplyCtrl"}).state("mailView",{url:"/dashboard/mail/:mailId",templateUrl:"/templates/admin/mail_view.html",controller:"AdminMailViewCtrl"})}]),angular.module("mailModule").controller("AdminMailInboxCtrl",["$scope","$http",function(a,b){b.get("/contact/messages").success(function(b){a.messages=b})}]),angular.module("mailModule").controller("AdminMailViewCtrl",["$scope",function(){}]),angular.module("mailModule").controller("AdminMailReplyCtrl",["$scope",function(){}]),angular.module("AdminApp",["userModule","videoModule","studioModule","settingsModule","mailModule","ngRoute","ui.bootstrap","ui.router","xeditable","restangular","angular-loading-bar","checklist-model","angularMoment","UserApp","rcWizard","rcForm","rcDisabledBootstrap"]).config(["$interpolateProvider","$locationProvider","$sceDelegateProvider","RestangularProvider","cfpLoadingBarProvider","$stateProvider","$urlRouterProvider",function(a,b,c,d,e,f,g){a.startSymbol("{[{"),a.endSymbol("}]}"),b.html5Mode(!0),d.setBaseUrl("http://api."+window.location.host),e.latencyThreshold=500,e.includeSpinner=!0,c.resourceUrlWhitelist(["self","http://slate.3digitalrock.com/**","http://slate.3digitalrockstudios.com/**","http://slate.3digitalrockstudios.com.s3.amazonaws.com/**"]),d.addResponseInterceptor(function(a,b){var c;return c="getList"===b?a.items:a}),d.setResponseExtractor(function(a){var b=a;return b.originalElement=angular.copy(a),b}),f.state("dashboard",{url:"/dashboard",templateUrl:"/templates/admin/home.html"}),g.otherwise("/dashboard")}]).factory("WebApi",["Restangular","$location",function(a,b){return a.withConfig(function(a){a.setBaseUrl("http://"+b.host())})}]).factory("Videos",["Restangular",function(a){return a.service("videos")}]).controller("AdminDashboardCtrl",["$scope",function(a){a.user.first_name||(a.user.first_name="Friend")}]).run(["editableOptions","user",function(a,b){b.init({appId:"542b63aff0d72",heartbeatInterval:0}),a.theme="default"}]);